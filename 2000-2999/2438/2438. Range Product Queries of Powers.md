# 2438. Range Product Queries of Powers

## Problem Info

- **Difficulty:** Medium
- **Topics:** Array, Bit Manipulation, Prefix Sum
- [Link to the problem](https://leetcode.com/problems/range-product-queries-of-powers/)

## Description

Given a positive integer `n`, there exists a 0-indexed array called `powers`, composed of the minimum number of powers of 2 that sum to `n`. The array is sorted in non-decreasing order, and there is only one way to form the array.

You are also given a 0-indexed 2D integer array `queries`, where `queries[i] = [lefti, righti]`. Each `queries[i]` represents a query where you have to find the product of all `powers[j]` with `lefti <= j <= righti`.

Return an array `answers`, equal in length to `queries`, where `answers[i]` is the answer to the ith query. Since the answer to the ith query may be too large, each `answers[i]` should be returned modulo 10^9 + 7.

## Examples

- **Example 1:**
  - Input: `n = 15`, `queries = [[0,1],[2,2],[0,3]]`
  - Output: `[2,4,64]`
  - Explanation: For n = 15, powers = [1,2,4,8]. Answer to 1st query: powers[0] * powers[1] = 1 * 2 = 2. Answer to 2nd query: powers[2] = 4. Answer to 3rd query: powers[0] * powers[1] * powers[2] * powers[3] = 1 * 2 * 4 * 8 = 64.

- **Example 2:**
  - Input: `n = 2`, `queries = [[0,0]]`
  - Output: `[2]`
  - Explanation: For n = 2, powers = [2]. The answer to the only query is powers[0] = 2.

## Constraints

- `1 <= n <= 10^9`
- `1 <= queries.length <= 10^5`
- `0 <= starti <= endi < powers.length`

---

## Solution

1. **Convert to binary representation**: Find which powers of 2 make up n by examining its binary representation
2. **Extract power exponents**: Store the exponents of each power of 2 that appears in n
3. **Process queries**: For each query range, sum the exponents and compute 2^sum mod (10^9 + 7)
4. **Optimize with modular arithmetic**: Use the property that (a * b) mod m = ((a mod m) * (b mod m)) mod m

**Complexity:**

- **Time:** O(log n + q * k), where q is the number of queries and k is the average query range length
- **Space:** O(log n), for storing the power exponents

**Python Code:**

```python
from typing import List

class Solution:
    def productQueries(self, n: int, queries: List[List[int]]) -> List[int]:
        MOD = 10 ** 9 + 7
        
        # Find powers of 2 that sum to n by examining binary representation
        binary_str = format(n, 'b')
        powers = []
        
        # Extract exponents of powers of 2 from binary representation
        for i in range(len(binary_str) - 1, -1, -1):
            if binary_str[i] == '1':
                powers.append(len(binary_str) - i - 1)
        
        answers = []
        for q in queries:
            l, r = q[0], q[1]
            
            if l == r:
                # Single element query
                answers.append(2 ** powers[l] % MOD)
            else:
                # Range query: sum exponents and compute 2^sum
                exponent_sum = sum(powers[l:r+1])
                answers.append(2 ** exponent_sum % MOD)
        
        return answers
```