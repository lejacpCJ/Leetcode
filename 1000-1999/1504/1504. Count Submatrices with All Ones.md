# 1504. Count Submatrices With All Ones

## Problem Info

- **Difficulty:** Medium
- **Topics:** Array, Dynamic Programming, Stack, Matrix, Monotonic Stack
- [Link to the problem](https://leetcode.com/problems/count-submatrices-with-all-ones/)

## Description

Given an `m x n` binary matrix `mat`, return the number of submatrices that have all ones.

---

### Example 1

- **Input:** `mat = [[1,0,1],[1,1,0],[1,1,0]]`
- **Output:** `13`
- **Explanation:**
    - There are 6 rectangles of side 1x1.
    - There are 2 rectangles of side 1x2.
    - There are 3 rectangles of side 2x1.
    - There is 1 rectangle of side 2x2.
    - There is 1 rectangle of side 3x1.
    - Total number of rectangles = 6 + 2 + 3 + 1 + 1 = 13.

### Example 2

- **Input:** `mat = [[0,1,1,0],[0,1,1,1],[1,1,1,0]]`
- **Output:** `24`
- **Explanation:**
    - There are 8 rectangles of side 1x1.
    - There are 5 rectangles of side 1x2.
    - There are 2 rectangles of side 1x3.
    - There are 4 rectangles of side 2x1.
    - There are 2 rectangles of side 2x2.
    - There are 2 rectangles of side 3x1.
    - There is 1 rectangle of side 3x2.
    - Total number of rectangles = 8 + 5 + 2 + 4 + 2 + 2 + 1 = 24.

---

## Constraints

- `1 <= m, n <= 150`
- `mat[i][j]` is either `0` or `1`.

---

## Solution

1. **Build heights:** For each row, build an array `heights` where `heights[j]` is the number of consecutive ones above (and including) the current cell.
2. **Count rectangles:** For each cell in the row, iterate leftwards and keep track of the minimum height seen so far. For each step, add the minimum height to the answer.
3. **Sum up:** The sum over all rows and columns gives the total number of submatrices with all ones.

**Complexity:**
- **Time:** O(m * nÂ²)
- **Space:** O(n)

**Python Code:**

```python
from typing import List

class Solution:
    def numSubmat(self, mat: List[List[int]]) -> int:
        m, n = len(mat), len(mat[0])
        heights = [0] * n
        result = 0

        for i in range(m):
            for j in range(n):
                if mat[i][j]:
                    heights[j] += 1
                else:
                    heights[j] = 0

            for j in range(n):
                if heights[j] == 0:
                    continue
                min_height = heights[j]
                for k in range(j, -1, -1):
                    if heights[k] == 0:
                        break
                    min_height = min(min_height, heights[k])
                    result += min_height

        return result
```