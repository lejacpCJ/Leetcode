# 3607. Power Grid Maintenance

## Problem Info

- **Difficulty:** Medium
- **Topics:** Array, Hash Table, Depth-First Search, Breadth-First Search, Union Find, Graph, Heap (Priority Queue), Ordered Set
- [Link to the problem](https://leetcode.com/problems/power-grid-maintenance/)

## Description

You are given an integer `c` representing `c` power stations, each with a unique identifier from `1` to `c` (1-based indexing).

Stations are interconnected via `n` bidirectional cables, given as `connections`, where `connections[i] = [ui, vi]` means a cable between station `ui` and `vi`. Directly or indirectly connected stations form a power grid.

All stations start online.

You are given `queries`, where each query is:

- `[1, x]`: Maintenance check for station `x`. If `x` is online, it resolves the check. If offline, the smallest id online station in the same grid resolves it. If none, return `-1`.
- `[2, x]`: Station `x` goes offline.

Return an array of integers for each `[1, x]` query in order.

**Note:** The grid structure does not change when a station goes offline.

## Examples

### Example 1

- **Input:** `c = 5`, `connections = [[1,2],[2,3],[3,4],[4,5]]`, `queries = [[1,3],[2,1],[1,1],[2,2],[1,2]]`
- **Output:** `[3,2,3]`
- **Explanation:**
  - All stations `{1,2,3,4,5}` are online and form one grid.
  - `[1,3]`: Station 3 is online → return 3.
  - `[2,1]`: Station 1 goes offline.
  - `[1,1]`: Station 1 is offline, smallest online in grid is 2 → return 2.
  - `[2,2]`: Station 2 goes offline.
  - `[1,2]`: Station 2 is offline, smallest online in grid is 3 → return 3.

### Example 2

- **Input:** `c = 3`, `connections = []`, `queries = [[1,1],[2,1],[1,1]]`
- **Output:** `[1,-1]`
- **Explanation:**
  - Each station is its own grid.
  - `[1,1]`: Station 1 is online → return 1.
  - `[2,1]`: Station 1 goes offline.
  - `[1,1]`: Station 1 is offline, no online station in grid → return -1.

## Constraints

- `1 <= c <= 10^5`
- `0 <= n == connections.length <= min(10^5, c * (c - 1) / 2)`
- `connections[i].length == 2`
- `1 <= ui, vi <= c`
- `ui != vi`
- `1 <= queries.length <= 2 * 10^5`
- `queries[i].length == 2`
- `queries[i][0]` is either 1 or 2
- `1 <= queries[i][1] <= c`

---

## Solution

1. **Find Components:** Use Union Find to assign each station a component ID.
2. **Track Online Stations:** For each component, maintain a min-heap of online station IDs.
3. **Process Queries:**
   - `[2, x]`: Mark `x` as offline.
   - `[1, x]`: If `x` is online, return `x`. Else, return the smallest online station in its component, or `-1` if none.

**Complexity:**

- **Time:** O((n + q) log c), where n = connections, q = queries.
- **Space:** O(c)

**Python Code:**

```python
from typing import List
from collections import defaultdict
import heapq

class Solution:
    def processQueries(self, c: int, connections: List[List[int]], queries: List[List[int]]) -> List[int]:
        parents = [i for i in range(c+1)]
        online_status = [True] * (c+1)

        def find(x):
            if x != parents[x]:
                parents[x] = find(parents[x])
            return parents[x]

        def union(u, v):
            pu, pv = find(u), find(v)
            if pu != pv:
                if pu <= pv:
                    parents[pv] = pu
                else:
                    parents[pu] = pv

        for u, v in connections:
            union(u, v)

        min_in_component = defaultdict(list)
        for i in range(1, c+1):
            heapq.heappush(min_in_component[find(i)], i)

        res = []
        for op, x in queries:
            if op == 2:
                online_status[x] = False
            else:
                if online_status[x]:
                    res.append(x)
                else:
                    min_in_component_heap, notFound = min_in_component[find(x)], True
                    while min_in_component_heap:
                        station = min_in_component_heap[0]
                        if online_status[station]:
                            res.append(station)
                            notFound = False
                            break
                        heapq.heappop(min_in_component_heap)
                    if notFound:
                        res.append(-1)
        return res
```
